{"version":3,"sources":["../src/index.js"],"names":["MarkdownNavbar","props","_winScroll","scrollTop","window","pageYOffset","document","documentElement","body","newHeadingList","_getHeadingList","map","h","distanceToTop","Math","abs","headingTopOffset","offsetTop","distanceList","minDistance","min","curHeading","find","setState","currentListNo","listNo","state","addTargetTimeout","clearTimeout","setTimeout","_initheadingsId","addEventListener","scrollTimeout","removeEventListener","contentWithoutCode","source","replace","pattOfTitle","matchResult","match","navData","r","i","index","level","length","text","levelCount","filter","startLevel","startLevelCount","forEach","t","toString","w","$1","$2","parseInt","result","nav","indexOf","dataId","target","querySelector","scrollTo","_getNavStructure","headings","querySelectorAll","curheading","Array","prototype","slice","apply","innerText","dataset","id","declarative","headingId","location","hash","trim","_scrollToTarget","headingList","push","tBlocks","cls","evt","preventDefault","random","substring","ordered","className","propTypes","string","bool","number","defaultProps"],"mappings":"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","file":"index.js","sourcesContent":["import 'core-js/shim';\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\n\nexport class MarkdownNavbar extends Component {\n  static propTypes = {\n    source: PropTypes.string,\n    ordered: PropTypes.bool,\n    headingTopOffset: PropTypes.number,\n    declarative: PropTypes.bool,\n    className: PropTypes.string,\n  };\n\n  static defaultProps = {\n    source: '',\n    ordered: true,\n    headingTopOffset: 0,\n    declarative: false,\n    className: '',\n  };\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentListNo: '',\n    };\n  }\n\n  componentWillReceiveProps() {\n    if (this.addTargetTimeout) {\n      clearTimeout(this.addTargetTimeout);\n    }\n\n    this.addTargetTimeout = setTimeout(() => {\n      this._initheadingsId();\n      document.addEventListener('scroll', this._winScroll, false);\n    }, 1e3);\n  }\n\n  componentWillUnmount() {\n    if (this.addTargetTimeout) {\n      clearTimeout(this.addTargetTimeout);\n    }\n    if (this.scrollTimeout) {\n      clearTimeout(this.scrollTimeout);\n    }\n    document.removeEventListener('scroll', this._winScroll, false);\n  }\n\n  _getNavStructure() {\n    const contentWithoutCode = this.props.source.replace(\n      /```[^`\\n]*\\n+[^```]+```\\n+/g,\n      ''\n    );\n\n    const pattOfTitle = /#+\\s([^#\\n]+)\\n*/g;\n    const matchResult = contentWithoutCode.match(pattOfTitle);\n\n    if (!matchResult) {\n      return [];\n    }\n\n    const navData = matchResult.map((r, i) => ({\n      index: i,\n      level: r.match(/^#+/g)[0].length,\n      text: r.replace(pattOfTitle, '$1'),\n    }));\n\n    const levelCount = level => navData.filter(r => r.level === level).length;\n    let startLevel = 1;\n    let startLevelCount = levelCount(startLevel);\n    while (!startLevelCount) {\n      startLevel += 1;\n      startLevelCount = levelCount(startLevel);\n    }\n\n    let listNo = 1;\n    navData.forEach(t => {\n      if (t.level === startLevel) {\n        t.listNo = listNo.toString();\n        listNo += 1;\n      }\n    });\n\n    navData.forEach((t, i) => {\n      if (!t.listNo) {\n        if (navData[i - 1] && t.level === navData[i - 1].level + 1) {\n          t.listNo = `${navData[i - 1].listNo}.1`;\n        } else if (navData[i - 1] && t.level === navData[i - 1].level) {\n          t.listNo = navData[i - 1].listNo.replace(\n            /^(.+\\.)(\\d+)$/g,\n            (w, $1, $2) => `${$1}${parseInt($2, 10) + 1}`\n          );\n        } else {\n          t.listNo = '';\n        }\n      }\n    });\n\n    const result = navData.map(nav => ({\n      ...nav,\n      listNo: nav.listNo.indexOf('.') < 0 ? `${nav.listNo}.` : nav.listNo,\n      text: nav.text.replace(/^(\\d+\\.)+\\s?/g, '').replace(/^\\d+\\.?\\s?/g, ''),\n    }));\n\n    return result;\n  }\n\n  _scrollToTarget(dataId) {\n    if (this.scrollTimeout) {\n      clearTimeout(this.scrollTimeout);\n    }\n\n    // ToDo: create one new `scrollTo` method for different browsers.\n    this.scrollTimeout = setTimeout(() => {\n      const target = document.querySelector(`[data-id=\"${dataId}\"]`);\n      window.scrollTo(0, target.offsetTop - this.props.headingTopOffset);\n    }, 1e2);\n  }\n\n  _initheadingsId() {\n    this._getNavStructure().forEach(t => {\n      const headings = document.querySelectorAll(`h${t.level}`);\n      const curheading = Array.prototype.slice\n        .apply(headings)\n        .find(\n          h =>\n            h.innerText\n              .replace(/^(\\d+\\.)+\\s?/g, '')\n              .replace(/^\\d+\\.?\\s?/g, '') === t.text\n        );\n\n      if (curheading) {\n        curheading.dataset.id = this.props.declarative\n          ? t.text\n          : `heading-${t.index}`;\n      }\n\n      const headingId = this.props.declarative\n        ? window.location.hash.replace(/^#/, '').trim()\n        : (window.location.hash.match(/heading-\\d+/g) || [])[0];\n\n      if (headingId && headingId === curheading.dataset.id) {\n        this._scrollToTarget(headingId);\n        this.setState({\n          currentListNo: t.listNo,\n        });\n      }\n    });\n  }\n\n  _getHeadingList() {\n    const headingList = [];\n\n    this._getNavStructure().forEach(t => {\n      const headings = document.querySelectorAll(`h${t.level}`);\n      const curheading = Array.prototype.slice\n        .apply(headings)\n        .find(\n          h =>\n            h.innerText\n              .replace(/^(\\d+\\.)+\\s?/g, '')\n              .replace(/^\\d+\\.?\\s?/g, '') === t.text\n        );\n      if (curheading) {\n        headingList.push({\n          dataId: this.props.declarative ? t.text : `heading-${t.index}`,\n          listNo: t.listNo,\n          offsetTop: curheading.offsetTop,\n        });\n      }\n    });\n\n    return headingList;\n  }\n\n  _winScroll = () => {\n    const scrollTop =\n      window.pageYOffset ||\n      document.documentElement.scrollTop ||\n      document.body.scrollTop ||\n      0;\n\n    const newHeadingList = this._getHeadingList().map(h => ({\n      ...h,\n      distanceToTop: Math.abs(\n        scrollTop + this.props.headingTopOffset - h.offsetTop\n      ),\n    }));\n    const distanceList = newHeadingList.map(h => h.distanceToTop);\n    const minDistance = Math.min(...distanceList);\n    const curHeading = newHeadingList.find(\n      h => h.distanceToTop === minDistance\n    );\n\n    this.setState({\n      currentListNo: curHeading.listNo,\n    });\n  };\n\n  render() {\n    const tBlocks = this._getNavStructure().map(t => {\n      const cls = `title-anchor title-level${t.level} ${\n        this.state.currentListNo === t.listNo ? 'active' : ''\n      }`;\n\n      return (\n        <a\n          className={cls}\n          href={this.props.declarative ? `#${t.text}` : `#heading-${t.index}`}\n          onClick={evt => {\n            evt.preventDefault();\n            this._scrollToTarget(\n              this.props.declarative ? t.text : `heading-${t.index}`\n            );\n            this.setState({\n              currentListNo: t.listNo,\n            });\n          }}\n          key={`title_anchor_${Math.random()\n            .toString(36)\n            .substring(2)}`}>\n          {this.props.ordered ? <small>{t.listNo}</small> : null}\n          {t.text}\n        </a>\n      );\n    });\n\n    return (\n      <div className={`markdown-navigation ${this.props.className}`}>\n        {tBlocks}\n      </div>\n    );\n  }\n}\n\nexport default MarkdownNavbar;\n"]}